# pizzaOrder
Pizza order rest services

Intellij and java 11 was used for this assignment

Summary
-------
Below two separated projects are created to achieve this pizza ordering assignment
1) pizza-message-generator-service - A rest service to generate json pizza message and be consumed by 2nd rest service to store pizza order to H2 
2) pizza-order-service - A rest service to consume pizza message generated by 1st rest service and store the order to H2 database.  This service is protected by JWT for security purpose    

How to run project
------------------
In Intellij project view, 

1) pizza-message-generator-service
Run class PizzaMessageGeneratorServiceApplication, this will be running on port 8081

2) pizza-order-service
Run class PizzaOrderServiceApplication, this will be running on port 8082

How to test
-----------
Once the two projects are running, 

1) pizza-message-generator-service

Type this in Chrome browser
http://localhost:8081/pizzaMessage/pizza
A message like this one will return in response 
{"name":"hawaiian","quantity":1,"price":16.0} 
 

2) pizza-order-service

Test with "curl" command 

a) Run this this generate JWT token 
curl -X POST http://localhost:8082/auth/signin -H 'Content-Type: application/json' -d '{"username":"joe","password":"joe"}'
This will be generated: 
{"token":"eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJqb2UiLCJpYXQiOjE2NDY1NjE5NzUsImV4cCI6MTY0NjU3OTk3NX0.JP6V71KgLa03DU1j-QfxyAjN3cNAMJvs5yL9t-RuXemkfWyL6VvoKultDFXcRGLjyUzuidsAzarjaXv5DVpb4g"}

b) Run 2nd rest service with valid JWT token 
curl -X GET http://localhost:8082/pizzaOrder/orderSubmit -H 'Content-Type: application/json' -H 'Authorization: Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJqb2UiLCJpYXQiOjE2NDY1NjI1OTQsImV4cCI6MTY0NjU4MDU5NH0.Tx7Y9dBa9Bxv0q1fE8uJUZugLQLlMJXaXW4uPyfJRxfq-OZsEa8vW-R3HFU1HKgRWynTXwORTScqmc1k2CvEzQ'

With invalid token, this {"timestamp":"2022-03-06T10:35:00.018+00:00","status":401,"error":"Unauthorized","path":"/pizzaOrder/orderSubmit"} will be returned

Access H2 db to check inserted orders 
--------------------------------------
Type http://localhost:8082/h2-ui in browser

Generic H2 (Embedded) 
Driver class: org.h2.Driver
JDBC url: jdbc:h2:mem:testdb
User name: sa
Password: 

> SELECT * FROM PIZZA_ORDER 
